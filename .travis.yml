addons:
  ssh_known_hosts:
    - worldcubeassociation.org
    - staging.worldcubeassociation.org
before_install:
  # Decrypt the RSA key file.
  - openssl aes-256-cbc -K $encrypted_d2c91d5e690a_key -iv $encrypted_d2c91d5e690a_iv -in .travis/deploy_rsa.enc -out /tmp/deploy_rsa -d
  # Install Panadoc and wkhtmltopdf.
  - wget https://github.com/jgm/pandoc/releases/download/2.2.2.1/pandoc-2.2.2.1-1-amd64.deb -O pandoc.deb
  - sudo dpkg -i pandoc.deb
  # Copied from https://github.com/thewca/worldcubeassociation.org/blob/5698831f9addb26091641c80beadfa7c902bcb18/chef/site-cookbooks/wca/recipes/regulations.rb#L17-L18
  - wget https://github.com/wkhtmltopdf/wkhtmltopdf/releases/download/0.12.4/wkhtmltox-0.12.4_linux-generic-amd64.tar.xz -O wkhtml.tar.xz
  - sudo tar -xf wkhtml.tar.xz --strip-components=1 -C /usr/local
script: bin/build.sh
deploy:
  - provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN
    local_dir: documents
    target_branch: build
    on:
      branch: master
  - provider: script
    skip_cleanup: true
    script: bin/deploy.sh
    on:
      branch: master
